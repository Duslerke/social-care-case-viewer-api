# Build new database structure

## The problem we're trying to solve

The DB structure for case statuses has been drastically changed and simplified.
These scripts will put the changes in place.

## Justification for doing a manual update

We don't have database migrations set up for the API.

## The plan

1. Run SQL statements in Staging
2. Run SQL statements in Production

## Link to Jira ticket

https://hackney.atlassian.net/browse/SCT-1287

## SQL statement(s)

```sql
--altering person_case_status
ALTER TABLE IF EXISTS dbo.sccv_person_case_status
  RENAME COLUMN fk_case_status_type_id TO case_status_type;

ALTER TABLE dbo.sccv_person_case_status DROP CONSTRAINT fk_case_status_type;

ALTER TABLE IF EXISTS dbo.sccv_person_case_status
  ALTER COLUMN case_status_type TYPE varchar(256);
ALTER TABLE dbo.sccv_person_case_status
  ADD COLUMN discarded_at timestamp;
--creating table to store answers
CREATE TABLE IF NOT EXISTS dbo.sccv_person_case_status_answers
(
  id                             bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  fk_person_case_status_id       bigint,
  questions varchar(512),
  answers varchar(512),
  start_date timestamp,
    CONSTRAINT fk_case_status
        FOREIGN KEY(fk_person_case_status_id)
        REFERENCES dbo.sccv_person_case_status(id)
);
--dropping unused tables
DROP TABLE IF EXISTS dbo.sccv_person_case_status_field_option;
DROP TABLE IF EXISTS DBO.SCCV_CASE_STATUS_FIELD_OPTION;
DROP TABLE IF EXISTS DBO.SCCV_CASE_STATUS_FIELD;
DROP TABLE IF EXISTS DBO.SCCV_CASE_STATUS_TYPE;
```

## Useful resources

None
