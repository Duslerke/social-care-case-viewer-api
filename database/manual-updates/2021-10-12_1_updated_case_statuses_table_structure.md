# Update case statuses table structure

## The problem we're trying to solve

New simplified table structure for case statuses

## Justification for doing a manual update

We don't have mautomated migrations yet

## The plan

1. Run the SQL script below

## Link to Jira ticket

https://hackney.atlassian.net/browse/SCT-1287

## SQL statement(s)

```sql
--altering person_case_status
ALTER TABLE IF EXISTS dbo.sccv_person_case_status
  RENAME COLUMN fk_case_status_type_id TO case_status_type;

ALTER TABLE dbo.sccv_person_case_status DROP CONSTRAINT fk_case_status_type;

ALTER TABLE IF EXISTS dbo.sccv_person_case_status
  ALTER COLUMN case_status_type TYPE varchar(256);
ALTER TABLE dbo.sccv_person_case_status
  ADD COLUMN discarded_at timestamp;
--creating table to store answers
CREATE TABLE IF NOT EXISTS dbo.sccv_person_case_status_answers
(
  id                             bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  fk_person_case_status_id       bigint,
  option varchar(512),
  value varchar(512),
  start_date timestamp,
  sccv_created_at timestamp,
  sccv_created_by varchar(300),
  sccv_last_modified_at timestamp,
  sccv_last_modified_by varchar(300),
  CONSTRAINT fk_case_status
    FOREIGN KEY(fk_person_case_status_id)
      REFERENCES dbo.sccv_person_case_status(id)
);
--dropping unused tables
DROP TABLE IF EXISTS dbo.sccv_person_case_status_field_option;
DROP TABLE IF EXISTS DBO.SCCV_CASE_STATUS_FIELD_OPTION;
DROP TABLE IF EXISTS DBO.SCCV_CASE_STATUS_FIELD;
DROP TABLE IF EXISTS DBO.SCCV_CASE_STATUS_TYPE;

ALTER TABLE dbo.sccv_person_case_status
  DROP COLUMN discarded_at;
```
